# Refer to the Caddy docs for more information:
# https://caddyserver.com/docs/caddyfile

{
	acme_ca https://dv.acme-v02.api.pki.goog/directory
	metrics {
		per_host
	}
}

# Default options for internal facing sites
(home) {
	tls internal

	handle_errors {
		respond "{err.status_code} {err.status_text}"
	}
}

grafana.home {
	import home
	reverse_proxy http://192.168.254.221:3000
}

uptime.home {
	import home
	reverse_proxy http://192.168.254.224:3001
}

# Default options for external facing sites
(external) {
	header {
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		X-Xss-Protection "1; mode=block"
		X-Content-Type-Options "nosniff"
		X-Frame-Options "DENY"
		Content-Security-Policy "upgrade-insecure-requests"
		Referrer-Policy "strict-origin-when-cross-origin"
		Cache-Control "public, max-age=15, must-revalidate"
		Permissions-Policy "accelerometer=(), ambient-light-sensor=(), autoplay=(self), camera=(), encrypted-media=(), fullscreen=(self), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), midi=(), payment=(), picture-in-picture=(*), speaker-selection=(), usb=(), xr-spatial-tracking=()"
		[defer]
	}
	handle_errors {
		respond "{err.status_code} {err.status_text}"
	}
	file_server
}

(geeksbsmrt) {
	import external
    tls geeksbsmrt@gmail.com {
        ca https://dv.acme-v02.api.pki.goog/directory
        eab {env.GEEKSBSMRT_EAB_KID} {env.GEEKSBSMRT_EAB_MAC}
    }
}

geeksbsmrt.com {
	import geeksbsmrt

    root * /srv/geeksbsmrt.com
}

(smrtgeekdevs) {
	import external
    tls smrtgeekapps@gmail.com {
        ca https://dv.acme-v02.api.pki.goog/directory
        eab {env.SMRTGEEKDEVS_EAB_KID} {env.SMRTGEEKDEVS_EAB_MAC}
    }
}

smrtgeekdevs.com {
	#root * /var/www/smrtgeekdevs
}

pihole.smrtgeekdevs.com {
	import smrtgeekdevs

	redir / /admin{uri}
    reverse_proxy pihole
}


# *.smrtgeekdevs.com {
# 	tls internal
# 	@router host router.smrtgeekdevs.com
# 	handle @router {
# 		reverse_proxy https://192.168.0.1:8443
# 	}
# }
